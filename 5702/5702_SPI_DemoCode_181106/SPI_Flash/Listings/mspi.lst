C51 COMPILER V9.54   MSPI                                                                  11/06/2018 16:50:35 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MSPI
OBJECT MODULE PLACED IN .\Objects\mspi.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Src\mspi.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -mspi.lst) TABS(2) OBJECT(.\Objects\mspi.obj)

line level    source

   1          #include "mspi.h"
   2          /****************************************************************************************
   3          Function:   SPI Slave initialization
   4          input:      None
   5          Output:     None
   6          Return:     None
   7          ****************************************************************************************/
   8          void spi_master_init (void)
   9          {
  10   1        P0 |= 0x80;
  11   1        P0M |= 0x80;
  12   1        P0UR &= 0x7F;       // Set P0.7 (SSN) as output high 
  13   1      
  14   1        P1M &= 0xC7;
  15   1        P1M |= 0x18;
  16   1        P1UR |= 0x20;       // Be Master  MISO(P15) Input with pull-up   SCK(P13) & MOSI(P14) Output
  17   1      
  18   1        SPCON = 0xBE;       // Be Master Fcpu/128  CPOL = 1   CPHA = 1    
  19   1      
  20   1        SPCON |= 0x40;      // Enable SPI
  21   1      }
  22          /****************************************************************************************
  23          Function:   SPI Send byte
  24          input:      None
  25          Output:     None
  26          Return:     None
  27          ****************************************************************************************/
  28          uint8_t spi_WtRd_Byte (uint8_t cByte)
  29          {
  30   1        uint8_t cData;
  31   1        uint16_t cRetry = 0;
  32   1      
  33   1        SPDAT = cByte;                // Send Data
  34   1        while (SPSTA != 0x80)
  35   1        {
  36   2          cRetry++;
  37   2          _nop_();
  38   2          _nop_();
  39   2          if(cRetry >= WAIT_TIME)
  40   2          {
  41   3            return 0xFF;             // Error
  42   3          }
  43   2        }
  44   1        cData = SPDAT;               // Read Data
  45   1        
  46   1        return cData;
  47   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     58    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.54   MSPI                                                                  11/06/2018 16:50:35 PAGE 2   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
